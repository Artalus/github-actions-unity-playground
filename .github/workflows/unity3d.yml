name: Build and test a unity3d project

on: [push]

jobs:
  get_license:
    runs-on: unbuntu-latest
    container:
      image: gableroux/unity3d:2019.1.14f1

    steps:
    - uses: actions/checkout@v1
    - name: get license
      run: ./ci/get_license.sh

  test_editmode:
    runs-on: unbuntu-latest
    container:
      image: gableroux/unity3d:2019.1.14f1

    env:
      TEST_PLATFORM: editmode

    steps:
      - uses: actions/checkout@v1
      - name: before script
        run: ./ci/before_script.sh
      - name: test
        run: ./ci/test.sh

  test_playmode:
    runs-on: unbuntu-latest
    container:
      image: gableroux/unity3d:2019.1.14f1

    env:
      TEST_PLATFORM: playmode

    steps:
      - uses: actions/checkout@v1
      - name: before script
        run: ./ci/before_script.sh
      - name: test
        run: ./ci/test.sh

  build_StandaloneWindows64:
    runs-on: unbuntu-latest
    container:
      image: gableroux/unity3d:2019.1.14f1

    env:
      BUILD_TARGET: StandaloneWindows64

    steps:
      - uses: actions/checkout@v1
      - name: before script
        run: ./ci/before_script.sh
      - name: build
        run: ./ci/build.sh
      - uses: actions/upload-artifact@master
        with:
          name: my-artifact
          path: ./Builds/


  build_WebGL:
    runs-on: unbuntu-latest
    container:
      image: gableroux/unity3d:2019.1.14f1

    env:
      BUILD_TARGET: WebGL

    steps:
      - uses: actions/checkout@v1
      - name: before script
        run: ./ci/before_script.sh
      - name: build
        run: ./ci/build.sh
      - uses: actions/upload-artifact@master
        with:
          name: my-artifact
          path: ./Builds/

  build_StandaloneLinux64:
    runs-on: unbuntu-latest
    container:
      image: gableroux/unity3d:2019.1.14f1

    env:
      BUILD_TARGET: StandaloneLinux64

    steps:
      - uses: actions/checkout@v1
      - name: before script
        run: ./ci/before_script.sh
      - name: build
        run: ./ci/build.sh
      - uses: actions/upload-artifact@master
        with:
          name: my-artifact
          path: ./Builds/
